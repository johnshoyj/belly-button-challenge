<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Bellybutton Biodiversity</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="./static/js/app.js"></script>
</head>
<body>

  <div class="container">
    <div class="row">
      <div class="col-md-12 jumbotron text-center">
        <h1>Belly Button Biodiversity Dashboard</h1>
        <p>Use the interactive charts below to explore the dataset</p>
      </div>
    </div>
    <div class="row">
      <div class="col-md-2">
        <div class="well">
          <h5>Test Subject ID No.:</h5>
          <select id="selDataset" onchange="optionChanged(this.value)"></select>
        </div>
        <div class="panel panel-primary">
          <div class="panel-heading">
            <h3 class="panel-title">Demographic Info</h3>
          </div>
          <div id="sample-metadata" class="panel-body"></div>
        </div>
      </div>
      <div class="col-md-5">
        <div id="bar"></div>
      </div>
      <div class="col-md-5">
        <div id="gauge"></div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div id="bubble"></div>
      </div>
    </div>
  </div>

<script>
  
var samplesJsonPath = 'https://2u-data-curriculum-team.s3.amazonaws.com/dataviz-classroom/v1.1/14-Interactive-Web-Visualizations/02-Homework/samples.json';

// Load data from samples.json
d3.json(samplesJsonPath).then(function(data) {
    console.log(data);

    var testSubjectIds = data.names;

    // Populate the dropdown with Test Subject IDs
    var dropdown = d3.select("#selDataset");
    dropdown.selectAll("option")
        .data(testSubjectIds)
        .enter()
        .append("option")
        .attr("value", d => d)
        .text(d => d);

// Function to handle option change
window.optionChanged = function(selectedValue) {
        // Update demographic information based on the selected Test Subject ID
        var selectedData = data.samples.find(sample => sample.id === selectedValue);

        // Display demographic information in the panel body
        var panelBody = d3.select("#sample-metadata");
        panelBody.html(""); // Clear existing content

        // Append demographic information as paragraphs
        Object.entries(selectedData).forEach(([key, value]) => {
            panelBody.append("p").text(`${key}: ${value}`);
        });
    };

    // Take the top 10 OTUs
    var top10Otus = selectedSample.otu_ids.slice(0, 10);
        var top10Values = selectedSample.sample_values.slice(0, 10);
        var top10Labels = selectedSample.otu_labels.slice(0, 10);

        // Clear existing chart content
        d3.select("#bar-chart").html("");

        // Create a horizontal bar chart
        var chart = d3.select("#bar-chart")
            .attr("width", "100%")
            .attr("height", 300);

        var barHeight = 30;

        chart.selectAll("rect")
            .data(top10Values)
            .enter()
            .append("rect")
            .attr("x", 0)
            .attr("y", (d, i) => i * barHeight)
            .attr("width", d => d)
            .attr("height", barHeight)
            .attr("fill", "steelblue")
            .append("title")
            .text((d, i) => `${top10Labels[i]}: ${d}`);

        // Add labels
        chart.selectAll("text")
            .data(top10Values)
            .enter()
            .append("text")
            .attr("x", d => d + 5)
            .attr("y", (d, i) => i * barHeight + barHeight / 2)
            .attr("dy", "0.35em")
            .text((d, i) => `OTU ${top10Otus[i]}`)
            .attr("fill", "white");
    };

    // Trigger initial option change (assuming the first option is selected by default)
    optionChanged(testSubjectIds[0]);
}).catch(function(error) {
    console.error("Error loading samples.json:", error);
});
</script>

</body>

</html>
